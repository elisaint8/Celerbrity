<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>데미지계산기</title>
    <style>
        body {
            margin: 10px;
            padding: 10px;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            background: #c7ddf7;
            border-color: rgb(3, 243, 243);
            border-style: inset;
        }
        h3 {
            color:rgb(0, 48, 77)
        }
        hr {
            border-color: rgb(9, 180, 180);
            border-width: 2px;
            border-style: solid;
        }
        .stat {
            font-size: 13px;
            width: 320px;
            block-size: 30px;
            display: block;
            
        }

        .lblStatName {
            display: inline-block;
            font-size: 9pt;
            width: 130px;
            border: 1px;
            vertical-align: middle;
        }
        .lblSubName1{
            display: inline-block;
            width: 133px;
            border: 1px;
            vertical-align: middle;
        }
        .lblSubName2 {
            display: inline-block;
            width: 83px;
            border: 1px;
            vertical-align: middle;
        }
        .lblSubName3 {
            display: inline-block;
            width: 83px;
            border: 1px;
            vertical-align: middle;
        }

        .inputStat {
            width: 60px;
            text-align: right;
            margin-right: 20px;
            border-style: solid;
            border-radius: 5px;
            background-color: rgb(153, 245, 214);
            color: rgb(9, 124, 190);
        }

        .outputStat {
            width: 60px;
            text-align: right;
            font-size: 10pt;
            display: inline-block;
            border-style: solid;
            border-width: 2px;
            border-radius: 5px;
            background-color: rgb(196, 246, 248);
            color: rgb(46, 128, 235);
        }

        .buffStat {
            width: 60px;
            text-align: right;
            display: inline-block;
            border-style: solid;
            border-radius: 5px;
            background-color: rgb(196, 246, 248);
            color: rgb(46, 128, 235);
        }

        .totStat {
            width: 70px;
            text-align: right;
            border-style: solid;
            border-radius: 5px;
            background-color: rgb(196, 246, 248);
            color: rgb(46, 128, 235);
        }
        .totDmg {
            width: 150px;
            text-align: right;
            border-style: solid;
            border-radius: 5px;
            background-color: rgb(196, 246, 248);
            color: rgb(46, 128, 235);
        }
        .oper {
            font-size: 10pt;
            color: rgb(46, 128, 235);
        }
    </style>
</head>

<body>
    <input type='file' accept='text/plain' id = "file-input" name="file-input">
<form>
    <div name="cStat">
        <label>
            <h3>* 캐릭터 스탯</h3>
        </label>
        <div style="padding-bottom: 10px;">
            <label class="lblSubName1" for="stat">스탯이름</label>
            <label class="lblSubName2" for="stat">입력칸</label>
            <label class="lblSubName3" for="stat">적용값</label>           
        </div>
        <div class="stat">
            <label class="lblStatName" for="att">공격력</label>
            <input type="number" class="inputStat" name="inAtt" id="inAtt">
            <label class="outputStat" name="outAtt" id="outAtt" readonly>0</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="cri">치명타확률</label>
            <input type="number" class="inputStat" name="inCri" id="inCri">
            <label class="outputStat" name="outCri" id="outCri" readonly>0</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="cDmg">치명타피해</label>
            <input type="number" class="inputStat" name="inCDmg" id="inCDmg">
            <label class="outputStat" name="outCDmg" id="outCDmg" readonly>200</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="pDmg">방어관통력</label>
            <input type="number" class="inputStat" name="inPDmg" id="inPDmg">
            <label class="outputStat" name="outPDmg" id="outPDmg" readonly>0</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="dmg">데미지</label>
            <input type="number" class="inputStat" name="inADmg" id="inADmg">
            <label class="outputStat" name="outADmg" id="outADmg" readonly>100</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="bdmg">보스데미지</label>
            <input type="number" class="inputStat" name="inBDmg" id="inBDmg">
            <label class="outputStat" name="outBDmg" id="outBDmg" readonly>100</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="aspd">공격속도</label>
            <input type="number" class="inputStat" name="inASpd" id="inASpd">
            <label class="outputStat" name="outASpd" id="outASpd" readonly>100</label>
            <label class="oper">%</label>
        </div>
    </div>
    <div name="bStat">
    <label>
        <h3>* 버프 스탯</h3>
    </label>
        <div class="stat">
            <label class="lblStatName" for="attM">% 공격력</label>
            <input type="number" class="inputStat" name="inAttM" id="inAttM">
            <label class="oper">+</label>
            <label class="outputStat" name="outAttM" id="outAttM" readonly>0</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="attF">고정공격력</label>
            <input type="number" class="inputStat" name="inAttF" id="inAttF">
            <label class="oper">+</label> <label class="outputStat" name="outAttF" id="outAttF" readonly>0</label>
        </div>
        <div class="stat">
                <label class="lblStatName" for="attC">클래스공격력</label>
                <input type="number" class="inputStat" name="inAttC" id="inAttC" step="0.1">
                <label class="oper">+</label>
                <label class="outputStat" name="outAttC" id="outAttC" readonly>0</label>
                <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="criF">치명타확률</label>
            <input type="number" class="inputStat" name="inCriF" id="inCriF">
            <label class="oper">+</label>
            <label class="outputStat" name="outCriF" id="outCriF" readonly>0</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="cDmgF">치명타피해</label>
            <input type="number" class="inputStat" name="inCDmgF" id="inCDmgF">
            <label class="oper">+</label>
            <label class="outputStat" name="outCDmgF" id="outCDmgF" readonly>0</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="bDmgF">보스데미지</label>
            <input type="number" class="inputStat" name="inBDmgF" id="inBDmgF">
            <label class="oper">+</label>
            <label class="outputStat" name="outBDmgF" id="outBDmgF" readonly>0</label>
            <label class="oper">%</label>
        </div>
    </div>
    <div name="eStat">
        <label>
            <h3>* 적 스탯</h3>
        </label>
        <div class="stat">
            <label class="lblStatName" for="increADmg">받는 모든 피해량 증감</label>
            <input type="number" class="inputStat" name="inIncreADmg" id="inIncreADmg">
            <label class="oper"></label>
            <label class="outputStat" name="outIncreADmg" id="outIncreADmg" readonly>100</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="increPDmg">받는 물리 피해량 증감</label>
            <input type="number" class="inputStat" name="inIncrePDmg" id="inIncrePDmg">
            <label class="oper"></label>
            <label class="outputStat" name="outIncrePDmg" id="outIncrePDmg" readonly>100</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="criF">받는 마법 피해량 증감</label>
            <input type="number" class="inputStat" name="inIncreMDmg" id="inIncreMDmg">
            <label class="oper"></label>
            <label class="outputStat" name="outIncreMDmg" id="outIncreMDmg" readonly>100</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="eDef">방어력</label>
            <input type="number" class="inputStat" name="inEDef" id="inEDef">
            <label class="oper"></label>
            <label class="outputStat" name="outEDef" id="outEDef" readonly>0</label>
            <label class="oper"></label>
        </div>
    </div>
    <div name="sStat">
        <label>
            <h3>* 스킬 정보</h3>
        </label>
        <div class="stat">
            <label class="lblStatName" for="inSkillName">스킬 이름</label>
            <input type="text" class="inputStat" name="inSkillName" id="inSkillName">
            <label class="oper"></label>
            <label class="outputStat" name="outSkillName" id="outSkillName" readonly>0</label>
            <label class="oper"></label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="skillCoef">스킬 계수</label>
            <input type="number" class="inputStat" name="inSkillCoef" id="inSkillCoef" step="0.01">
            <label class="oper"></label>
            <label class="outputStat" name="outSkillCoef" id="outSkillCoef" readonly>0</label>
            <label class="oper"></label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="skillBDmg">스킬 기본데미지</label>
            <input type="number" class="inputStat" name="inSkillBDmg" id="inSkillBDmg">
            <label class="oper"></label>
            <label class="outputStat" name="outSkillBDmg" id="outSkillBDmg" readonly>100</label>
            <label class="oper"></label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="skillIncreDmg">스킬 데미지 증가</label>
            <input type="number" class="inputStat" name="inSkillIncreDmg" id="inSkillIncreDmg">
            <label class="oper"></label>
            <label class="outputStat" name="outSkillIncreDmg" id="outSkillIncreDmg" readonly>100</label>
            <label class="oper">%</label>
        </div>
        <div class="stat">
            <label class="lblStatName" for="skillCDmg">스킬 치명타 피해량</label>
            <input type="number" class="inputStat" name="inSkillCDmg" id="inSkillCDmg">
            <label class="oper">+</label>
            <label class="outputStat" name="outSkillCDmg" id="outSkillCDmg" readonly>0</label>
            <label class="oper">%</label>
        </div>
    </div>   

    <br>
    <input type="reset" class="btnComp" name="comp" id="comp" value="재입력"
    style="color: rgb(0, 48, 77);
    font-weight: 1000;
    width:80px;
    border-radius: 5px;
    background-color: #298dc7;
    border: none;
    text-align: center;
    text-decoration: none;
    ">
    <hr>
    <br>
    <div class="stat">
        <label class="lblStatName" for="totAtt">최종 공격력</label> 
        <input type="text" readonly class="totStat" name="totAtt" id="totAtt" value="0">
        <label class="oper"></label>
    </div>
    <div class="stat">
        <label class="lblStatName" for="totCri">최종 치명타 확률</label>
        <input type="text" readonly class="totStat" name="totCri" id="totCri" value="0">
        <label class="oper">%</label>
    </div>
    <div class="stat">
        <label class="lblStatName" for="totCri">최종 치명타데미지 증가</label>
        <input type="text" readonly class="totStat" name="totCDmg" id="totCDmg" value="0">
        <label class="oper">%</label>
    </div>
    <div class="stat">
        <label class="lblStatName" for="totADmg">최종 데미지 증가</label>
        <input type="text" readonly class="totStat" name="totADmg" id="totADmg" value="0">
        <label class="oper">%</label>
    </div>
    <div class="stat">
        <label class="lblStatName" for="totBDmg">최종 보스데미지 증가</label>
        <input type="text" readonly class="totStat" name="totBDmg" id="totBDmg" value="0">
        <label class="oper">%</label>
    </div>
    <div class="stat">
        <label class="lblStatName" for="totPDmg">최종 물리 피해량 증감</label>
        <input type="text" readonly class="totStat" name="totPDmg" id="totPDmg" value="0">
        <label class="oper">%</label>
    </div>
    <div class="stat">
        <label class="lblStatName" for="totMDmg">최종 마법 피해량 증감</label>
        <input type="text" readonly class="totStat" name="totMDmg" id="totMDmg" value="0">
        <label class="oper">%</label>
    </div>
    <div class="stat">
            <label class="lblStatName" for="totEDef">최종 적 방어력</label>
            <input type="text" readonly class="totStat" name="totEDef" id="totEDef" value="0">
            <label class="oper"></label>
    </div>
    <div class="stat">
        <label class="lblStatName" for="totDmg">최종 기본 데미지</label>
        <input type="text" readonly class="totDmg" name="totDmg" id="totDmg" value="0">
    </div>
    <div class="stat">
        <label class="lblStatName" for="totPSDmg">물리스킬 데미지</label>
        <input type="text" readonly class="totDmg" name="totPSDmg" id="totPSDmg" value="0">
    </div>
    <div class="stat">
        <label class="lblStatName" for="totMSDmg">마법스킬 데미지</label>
        <input type="text" readonly class="totDmg" name="totMSDmg" id="totMSDmg" value="0">
    </div>
</form>





    <script type="text/javascript">

       //참고 사이트들
       //https://gall.dcinside.com/mgallery/board/view/?id=vespa&no=599196&exception_mode=recommend&search_pos=-604002&s_type=search_all&s_keyword=%EA%B3%B5%EC%8B%9D&page=1
       //https://gall.dcinside.com/mgallery/board/view/?id=vespa&no=554178&exception_mode=recommend&search_pos=-556275&s_type=search_all&s_keyword=%EB%B0%A9%EA%B4%80&page=1
       //https://github.com/duckness/Mask-of-Goblin/blob/master/src/mixins/softcap.js
       //https://cafe.naver.com/kingsraid/736718 // 방어력 공식
       var changeStatClass = document.getElementsByClassName("inputStat");

        //캐릭터 스탯
        var att = document.getElementById("outAtt");
        var cri = document.getElementById("outCri");
        var cDmg = document.getElementById("outCDmg");
        var pDmg = document.getElementById("outPDmg");
        var aDmg = document.getElementById("outADmg");
        var bDmg = document.getElementById("outBDmg");
        var aSpd = document.getElementById("outASpd");

        //버프 스탯
        var attM = document.getElementById("outAttM");
        var attF = document.getElementById("outAttF");
        var attC = document.getElementById("outAttC");
        var criF = document.getElementById("outCriF");
        var cDmgF = document.getElementById("outCDmgF");
        var bDmgF = document.getElementById("outBDmgF");

        //적 스탯
        var increADmg = document.getElementById("outIncreADmg");
        var increPDmg = document.getElementById("outIncrePDmg");
        var increMDmg = document.getElementById("outIncreMDmg");
        var eDef = document.getElementById("outEDef");

        //스킬 정보
        var skillName = document.getElementById("outSkillName");
        var skillCoef = document.getElementById("outSkillCoef");
        var skillBDmg = document.getElementById("outSkillBDmg");
        var skillIncreDmg = document.getElementById("outSkillIncreDmg");
        var skillCDmg = document.getElementById("outSkillCDmg");
        
        //최종 스탯
        var totAtt = document.getElementById("totAtt");
        var totCri = document.getElementById("totCri");
        var totCDmg = document.getElementById("totCDmg");
        var totBDmg = document.getElementById("totBDmg");
        var totPDmg = document.getElementById("totPDmg");
        var totMDmg = document.getElementById("totMDmg");
        var totEDef = document.getElementById("totEDef");
        var totDmg = document.getElementById("totDmg");
        var totPSDmg = document.getElementById("totPSDmg");
        var totMSDmg = document.getElementById("totMSDmg");

        var stats = document.querySelectorAll('.outputStat');


        // var autoCal = document.querySelector('.lblStatName');
        // var buffAtt = document.querySelector('#buffAttR')

        //파일 이벤트리스너 등록
        document.getElementById("file-input").addEventListener("change", readFile, false); 
        var fileData;
        function readFile(e) {
            var file = e.target.files[0];
            if (!file) {
                return;
            }
            var reader = new FileReader();
            reader.onload = function(e) {
                fileData= e.target.result;
                // 파일 데이터를 사용할 기능 구현
                console.log(fileData); 
            };
            reader.readAsText(file);
        }

        comp.addEventListener("click",calcDmg);
        //입력칸들에게 이벤트리스너 등록
        for(var i = 0; i<changeStatClass.length; i++) {
            changeStatClass[i].addEventListener("blur",calcStat)
        }
        function calcStat(){
            //캐릭터 스탯
            att.innerText = document.getElementById("inAtt").value*1;
            cri.innerText = document.getElementById("inCri").value/10;
            cDmg.innerText = document.getElementById("inCDmg").value*1+200;
            pDmg.innerText = document.getElementById("inPDmg").value*1;
            aDmg.innerText = document.getElementById("inADmg").value*1+100;
            bDmg.innerText = document.getElementById("inBDmg").value*1+100;
            aSpd.innerText = document.getElementById("inASpd").value*1+100;

            //버프 스탯
            attM.innerText = document.getElementById("inAttM").value*1+100;
            attF.innerText = document.getElementById("inAttF").value*1;
            attC.innerText = document.getElementById("inAttC").value*1+100;
            criF.innerText = document.getElementById("inCriF").value/10;
            cDmgF.innerText = document.getElementById("inCDmgF").value*1;
            bDmgF.innerText = document.getElementById("inBDmgF").value*1;

            //적 스탯
            increADmg.innerText = document.getElementById("inIncreADmg").value*1+100;
            increPDmg.innerText = document.getElementById("inIncrePDmg").value*1+100;
            increMDmg.innerText = document.getElementById("inIncreMDmg").value*1+100;
            eDef.innerText = document.getElementById("inEDef").value*1;

            //스킬 정보
            skillName.innerText = document.getElementById("inSkillName").value;
            skillCoef.innerText = document.getElementById("inSkillCoef").value*1;
            skillBDmg.innerText = document.getElementById("inSkillBDmg").value*1;
            skillIncreDmg.innerText = document.getElementById("inSkillIncreDmg").value*1+100;
            skillCDmg.innerText = document.getElementById("inSkillCDmg").value*1;

            //최종 스탯
            totAtt.value = Math.round((att.innerText * (attM.innerText / 100) + attF.innerText*1) * attC.innerText/100);
            totCri.value = Math.min(Math.round(cri.innerText * 1 + criF.innerText * 1),100) ;
            totCDmg.value = Math.round(cDmg.innerText * 1 + cDmgF.innerText * 1);
            totADmg.value = Math.round(aDmg.innerText * 1 );
            totBDmg.value = Math.round(bDmg.innerText * 1 + bDmgF.innerText * 1);
            totPDmg.value = Math.round(increADmg.innerText * 1 + increPDmg.innerText * 1 - 100);
            totMDmg.value = Math.round(increADmg.innerText * 1 + increMDmg.innerText * 1 - 100);
            totEDef.value = Math.round(eDef.innerText * 1 );

            totDmg.value = comma(
                Math.round(
                    //(기본공격력)
                    ((totAtt.value))
                    //치명피해 계수 = 치명타확률*치피 + 노치명
                    * ((totCri.value/100) * ((totCDmg.value)/100) + (1 - (totCri.value/100))) 
                    //뎀증, 보스뎀증 계수
                    * (totADmg.value/100) * (totBDmg.value/100)
                    //적피증
                    * (totMDmg.value/100)
                )
            );

            totMSDmg.value = comma(
                Math.round(
                    //(기본공격력 * 계수 + 스킬 기본데미지)*스킬뎀증
                    (((totAtt.value * skillCoef.innerText) + skillBDmg.innerText*1) * skillIncreDmg.innerText/100)
                    //치명피해 계수 = 치명타확률*치피 + 노치명
                    * ((totCri.value/100) * ((totCDmg.value*1+skillCDmg.innerText*1)/100) + (1 - (totCri.value/100))) 
                    //뎀증, 보스뎀증 계수
                    * (totADmg.value/100) * (totBDmg.value/100)
                    //적피증
                    * (totMDmg.value/100)
                )
            );

            totPSDmg.value = comma(
                Math.round(
                    //(기본공격력 * 계수 + 스킬 기본데미지)*스킬뎀증
                    (((totAtt.value * skillCoef.innerText) + skillBDmg.innerText*1) * skillIncreDmg.innerText/100)
                    //치명피해 계수 = 치명타확률*치피 + 노치명
                    * ((totCri.value/100) * ((totCDmg.value*1+skillCDmg.innerText*1)/100) + (1 - (totCri.value/100))) 
                    //뎀증, 보스뎀증 계수
                    * (totADmg.value/100) * (totBDmg.value/100)
                    //적피증
                    * (totPDmg.value/100)
                )
            );
            
        }
        //콤마찍기
        function comma(str) {
            str = String(str);
            return str.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
        }
        function clickBtn() {
            totAtt.value = att.innerText;           
        }
        var totAtt
        function calcDmg(){
            totAtt = stats
        }

        function deadCode(){
            document.getElementById("outHp").innerText = document.getElementById("inHp").value;
            document.getElementById("outPDef").innerText = document.getElementById("inPDef").value;
            document.getElementById("outMDef").innerText = document.getElementById("inMDef").value;
        }
    </script>
</body>

</html>